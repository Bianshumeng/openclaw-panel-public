# AGENTS

最后更新：2026-02-17

## 项目介绍

本项目是龙虾 Bot（OpenClaw）的一套 Web 可视化控制台。  
定位是“插件式控制器”，不是修改龙虾 Bot 源码本体的分叉版本。

核心能力包括：
- 仪表盘状态查看（模型、渠道、运行状态、日志摘要等）
- 模型与提供商配置（默认模型、新增提供商、模板化配置）
- 渠道配置（Telegram、飞书等）
- Skills 管理
- 日志查看、版本检查与更新控制

技术形态：
- 后端：Node.js + Fastify
- 前端：静态页面（`public/`）
- 部署：Docker

---

## 项目背景

业务交付场景是：客户购买你的小服务器后，机器里已经预装龙虾 Bot 与本控制台。  
客户通过“母机公网 IP + 专属端口”访问控制台，而不是每台小机拥有独立公网 IP。

这决定了本项目在端口、地址、通信方式上的实现边界：
- 对外访问必须按“公网 IP + 端口”组织
- 容器内部通信优先走 Docker 内网和共享卷
- 控制台只负责“控制与编排”，不替代龙虾 Bot 自身业务运行

---

## 开发约束

### 1) 架构约束（硬性）
- 控制台必须保持“插件式控制器”定位，不直接改龙虾 Bot/OpenClaw 源码。
- 与运行时交互应通过既有可控边界：配置文件、Gateway RPC、服务控制、日志接口。
- 参考 `third_party/ClawX` 时只迁移可复用逻辑，不迁移 Electron 专属实现（IPC、桌面窗口、自动更新器等）。

### 2) 部署与端口约束（硬性）
- 系统运行在无独立 IP 的小机上，对外入口是“母机公网 IP + 分配端口”。
- 所有对外服务端口必须可配置（env/配置文件），禁止写死 `80/443/3000`。
- 前端展示的外部访问地址、Webhook 回调地址必须使用“公网 IP + 端口”。
- Docker 容器间通信走内部网络和共享卷，不走公网端口。
- 仅外部入站访问受端口映射约束；容器间内部通信不受该约束。
- 模板小鸡交付场景下，首启必须自动初始化并回填“地址与接入配置”（公网地址/网关地址/Webhook 地址）；禁止把手工填写这一步留给终端用户。

### 3) 环境一致性约束（硬性）
- 开发环境：Windows + Docker。
- 生产环境：Linux + Docker。
- 关键功能必须在 Linux 场景复验，不能只以 Windows 结果作为交付依据。

### 4) 实施约束
- 优先修根因，避免临时补丁长期化。
- 涉及配置写入的改动必须防止跨面板副作用（例如模型保存不应顺带改渠道配置）。
- 高风险动作（安装技能、批量写配置、升级/回滚）必须有明确提示、可回滚路径和结果证据。
- 每完成一个阶段，更新 `plan/` 下任务文档与状态，保证可追溯。

### 5) 默认产品边界
- 不做首次安装向导迁移。
- 不迁移任务调度与主题系统。
- Chat 能力仅迁移“多会话、流式消息、思考状态”等交互能力，不替代龙虾 Bot 原生对话页。

### 6) 镜像发布与源码暴露策略（硬性）
- 龙虾 Bot 镜像：保持“基于官方 OpenClaw 源码构建”的策略，本轮不做额外加固改造。
- 龙虾控制台镜像：必须使用多阶段构建，仅携带运行必需产物（最小运行镜像）。
- 控制台发布前默认执行运行产物构建（当前为 `npm run build:runtime`），并只复制 `src` 运行入口与 `public` 静态资源到运行层。
- 控制台代码保护采用“轻量压缩/混淆”策略（如打包与最小化），目标是提升提取与阅读成本，不承诺绝对防逆向。
- 任何把源码完整打进运行镜像的改动，均视为回归，提交前必须修正。

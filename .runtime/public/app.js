import{els as e,hasPanel as t,setMessage as a,setupTabs as s,setupTheme as r}from"./js/core/panel-core.js";import{setupConfigGenerator as c}from"./js/pages/config-generator-page.js";import{loadStatusOverview as o,setupDashboard as l,setupModelEditor as n,setSaveModelSettingsHandler as d}from"./js/pages/model-dashboard-page.js";import{loadSkillsStatus as i,setupSkillsPage as u}from"./js/pages/skills-page.js";import{loadChatSessions as m,setupChatConsole as g}from"./js/pages/chat-page.js";import{approveTelegramPairingFlow as p,checkAllUpdates as h,checkUpdate as _,loadErrorSummary as S,loadInitialData as k,loadTail as v,mutateVersion as y,resetTelegramAdvancedSettings as E,runService as q,saveAndTestFeishu as L,saveAndTestTelegram as b,saveModelSettings as f,saveSettings as j,setChannelTestResult as T,setupTelegramBasicFlow as $,startStream as C,stopStream as A,testDiscord as F,testFeishu as D,testSlack as M,testTelegram as w}from"./js/pages/system-page.js";function P(e,t,s,r){document.querySelector(e)?.addEventListener("click",()=>{t().catch(e=>{const t=String(e?.message||"请求失败");T(s,t,!1),a(`${r} 测试失败：${t}`,"error")})})}d(f),r(),s(),t("panel-dashboard")&&l(),t("panel-skills")&&u(),t("panel-chat-console")&&g(),(t("panel-model")||t("panel-model-add"))&&n(),t("panel-config-generator")&&c(),document.querySelector("#save_settings")?.addEventListener("click",()=>{j().catch(e=>a(e.message,"error"))}),document.querySelectorAll("[data-action]").forEach(e=>{e.addEventListener("click",()=>{q(e.dataset.action).catch(e=>a(e.message,"error"))})}),document.querySelector("#load_tail")?.addEventListener("click",()=>{v().catch(e=>a(e.message,"error"))}),document.querySelector("#load_errors")?.addEventListener("click",()=>{S().catch(e=>a(e.message,"error"))}),document.querySelector("#start_stream")?.addEventListener("click",C),document.querySelector("#stop_stream")?.addEventListener("click",A),document.querySelector("#tg_setup_basic")?.addEventListener("click",()=>{$().catch(e=>a(e.message,"error"))}),document.querySelector("#tg_pairing_approve")?.addEventListener("click",()=>{p().catch(e=>a(e.message,"error"))}),document.querySelector("#tg_save_advanced")?.addEventListener("click",()=>{j().catch(e=>a(e.message,"error"))}),document.querySelector("#tg_reset_advanced")?.addEventListener("click",()=>{E().catch(e=>a(e.message,"error"))}),document.querySelector("#save_and_test_telegram")?.addEventListener("click",()=>{b().catch(e=>a(e.message,"error"))}),document.querySelector("#save_and_test_feishu")?.addEventListener("click",()=>{L().catch(e=>a(e.message,"error"))}),P("#test_telegram",w,"tg_test_result","Telegram"),P("#test_feishu",D,"fs_test_result","Feishu"),P("#test_discord",F,"dc_test_result","Discord"),P("#test_slack",M,"sl_test_result","Slack"),document.querySelector("#bot_check_update")?.addEventListener("click",()=>{_({target:"bot"}).catch(e=>a(e.message,"error"))}),document.querySelector("#bot_upgrade_update")?.addEventListener("click",()=>{y("upgrade",{target:"bot"}).catch(e=>a(e.message,"error"))}),document.querySelector("#bot_rollback_update")?.addEventListener("click",()=>{y("rollback",{target:"bot"}).catch(e=>a(e.message,"error"))}),document.querySelector("#panel_check_update")?.addEventListener("click",()=>{_({target:"panel"}).catch(e=>a(e.message,"error"))}),document.querySelector("#panel_upgrade_update")?.addEventListener("click",()=>{y("upgrade",{target:"panel"}).catch(e=>a(e.message,"error"))}),document.querySelector("#panel_apply_update")?.addEventListener("click",()=>{y("apply",{target:"panel"}).catch(e=>a(e.message,"error"))}),document.querySelector("#panel_rollback_update")?.addEventListener("click",()=>{y("rollback",{target:"panel"}).catch(e=>a(e.message,"error"))});const x=t("panel-update");k().then(()=>{e.runtimeState&&(e.runtimeState.textContent="面板已连接"),a("初始化完成","ok"),e.serviceState&&q("status").catch(()=>{}),e.logOutput&&v().catch(()=>{}),(t("panel-dashboard")||e.errorSummary)&&(S({silent:!0}).catch(e=>a(`错误摘要加载失败：${e.message}`,"error")),_({silent:!0}).catch(e=>a(`版本信息加载失败：${e.message}`,"error")),o({silent:!0}).catch(e=>a(`状态总览加载失败：${e.message}`,"error"))),t("panel-skills")&&i({silent:!0}).catch(e=>a(`Skills 页面加载失败：${e.message}`,"error")),t("panel-chat-console")&&m({silent:!0}).catch(e=>a(`智能对话页加载失败：${e.message}`,"error")),x&&h({silent:!0}).catch(e=>a(`版本信息加载失败：${e.message}`,"error"))}).catch(t=>{e.runtimeState&&(e.runtimeState.textContent="面板连接失败"),a(`初始化失败：${t.message}`,"error")});
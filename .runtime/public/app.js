import{els as e,hasPanel as t,setMessage as a,setupTabs as s,setupTheme as r}from"./js/core/panel-core.js";import{setupConfigGenerator as c}from"./js/pages/config-generator-page.js";import{loadStatusOverview as l,setupDashboard as n,setupModelEditor as o,setSaveModelSettingsHandler as d}from"./js/pages/model-dashboard-page.js";import{loadSkillsStatus as i,setupSkillsPage as m}from"./js/pages/skills-page.js";import{approveTelegramPairingFlow as u,checkUpdate as g,loadErrorSummary as p,loadInitialData as S,loadTail as h,mutateVersion as _,resetTelegramAdvancedSettings as v,runService as k,saveAndTestFeishu as y,saveAndTestTelegram as E,saveModelSettings as q,saveSettings as L,setChannelTestResult as f,setupTelegramBasicFlow as T,startStream as j,stopStream as b,testDiscord as $,testFeishu as F,testSlack as A,testTelegram as C}from"./js/pages/system-page.js";function D(e,t,s,r){document.querySelector(e)?.addEventListener("click",()=>{t().catch(e=>{const t=String(e?.message||"请求失败");f(s,t,!1),a(`${r} 测试失败：${t}`,"error")})})}d(q),r(),s(),t("panel-dashboard")&&n(),t("panel-skills")&&m(),(t("panel-model")||t("panel-model-add"))&&o(),t("panel-config-generator")&&c(),document.querySelector("#save_settings")?.addEventListener("click",()=>{L().catch(e=>a(e.message,"error"))}),document.querySelectorAll("[data-action]").forEach(e=>{e.addEventListener("click",()=>{k(e.dataset.action).catch(e=>a(e.message,"error"))})}),document.querySelector("#load_tail")?.addEventListener("click",()=>{h().catch(e=>a(e.message,"error"))}),document.querySelector("#load_errors")?.addEventListener("click",()=>{p().catch(e=>a(e.message,"error"))}),document.querySelector("#start_stream")?.addEventListener("click",j),document.querySelector("#stop_stream")?.addEventListener("click",b),document.querySelector("#tg_setup_basic")?.addEventListener("click",()=>{T().catch(e=>a(e.message,"error"))}),document.querySelector("#tg_pairing_approve")?.addEventListener("click",()=>{u().catch(e=>a(e.message,"error"))}),document.querySelector("#tg_save_advanced")?.addEventListener("click",()=>{L().catch(e=>a(e.message,"error"))}),document.querySelector("#tg_reset_advanced")?.addEventListener("click",()=>{v().catch(e=>a(e.message,"error"))}),document.querySelector("#save_and_test_telegram")?.addEventListener("click",()=>{E().catch(e=>a(e.message,"error"))}),document.querySelector("#save_and_test_feishu")?.addEventListener("click",()=>{y().catch(e=>a(e.message,"error"))}),D("#test_telegram",C,"tg_test_result","Telegram"),D("#test_feishu",F,"fs_test_result","Feishu"),D("#test_discord",$,"dc_test_result","Discord"),D("#test_slack",A,"sl_test_result","Slack"),document.querySelector("#panel_check_update")?.addEventListener("click",()=>{g({target:"panel"}).catch(e=>a(e.message,"error"))}),document.querySelector("#panel_upgrade_update")?.addEventListener("click",()=>{_("upgrade",{target:"panel"}).catch(e=>a(e.message,"error"))}),document.querySelector("#panel_apply_update")?.addEventListener("click",()=>{_("apply",{target:"panel"}).catch(e=>a(e.message,"error"))}),document.querySelector("#panel_rollback_update")?.addEventListener("click",()=>{_("rollback",{target:"panel"}).catch(e=>a(e.message,"error"))});const M=t("panel-update");S().then(()=>{e.runtimeState&&(e.runtimeState.textContent="面板已连接"),a("初始化完成","ok"),e.serviceState&&k("status").catch(()=>{}),e.logOutput&&h().catch(()=>{}),(t("panel-dashboard")||e.errorSummary)&&(p({silent:!0}).catch(e=>a(`错误摘要加载失败：${e.message}`,"error")),g({silent:!0}).catch(e=>a(`版本信息加载失败：${e.message}`,"error")),l({silent:!0}).catch(e=>a(`状态总览加载失败：${e.message}`,"error"))),t("panel-skills")&&i({silent:!0}).catch(e=>a(`Skills 页面加载失败：${e.message}`,"error")),M&&g({silent:!0,target:"panel"}).catch(e=>a(`版本信息加载失败：${e.message}`,"error"))}).catch(t=>{e.runtimeState&&(e.runtimeState.textContent="面板连接失败"),a(`初始化失败：${t.message}`,"error")});
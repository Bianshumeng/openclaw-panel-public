import{AICODECAT_PROVIDER as e,DEFAULT_MODEL_OPTIONS as t,MODEL_PROFILE_BY_FAMILY as r,fillDefaultModelOptions as o,modelFamilyById as i,setMessage as n}from"../core/panel-core.js";import{apiModeFamily as c,convertConfig as u,resolveAicodecatBaseUrl as s}from"../../config-generator.js";function l(){const l=document.querySelector("#cfg_provider"),a=document.querySelector("#cfg_provider_custom"),d=document.querySelector("#cfg_apimode"),g=document.querySelector("#cfg_apimode_custom"),m=document.querySelector("#cfg_baseurl"),f=document.querySelector("#cfg_baseurl_custom"),_=document.querySelector("#cfg_model_id"),v=document.querySelector("#cfg_model_id_custom"),p=document.querySelector("#cfg_apikey"),y=document.querySelector("#cfg_apikey_toggle"),S=document.querySelector("#cfg_context_window"),x=document.querySelector("#cfg_max_tokens"),q=document.querySelector("#cfg_reasoning"),w=document.querySelector("#cfg_inherit_existing"),k=document.querySelector("#cfg_input"),L=document.querySelector("#cfg_output"),b=document.querySelector("#cfg_status"),A=document.querySelector("#cfg_generate"),C=document.querySelector("#cfg_copy");if(!(l&&d&&m&&_&&p&&S&&x&&q&&w&&k&&L&&b))return;o(_,{includeCustom:!0,selectedValue:String(_.value||"").trim()});const E={gpt:t.find(e=>"gpt"===i(e.id))?.id||"gpt-5.2",claude:t.find(e=>"claude"===i(e.id))?.id||"claude-sonnet-4-5-20250929",gemini:t.find(e=>"gemini"===i(e.id))?.id||"gemini-3-pro-preview"},I={gpt:!0,claude:!0,gemini:!1},O=(e,t)=>{e&&t&&t.classList.toggle("is-visible","custom"===e.value)},h=(e,t)=>e?"custom"===e.value?String(t?.value||"").trim():String(e.value||"").trim():"",P=e=>{const t=Number(e);return!Number.isFinite(t)||t<=0?null:Math.floor(t)},M=(e=!1)=>{const t=(()=>{const e=h(_,v);return e?i(e):c(h(d,g))})(),o=r[t]||r.gpt;(e||!String(S.value||"").trim())&&(S.value=String(o?.contextWindow||2e5)),(e||!String(x.value||"").trim())&&(x.value=String(o?.maxTokens||8192)),e&&(q.checked=!!I[t])},T=e=>{b.value=e;const t="å®Œæˆ"===e,r="å¤„ç†ä¸­"===e;b.classList.toggle("is-fail","å¤±è´¥"===e),b.classList.toggle("is-done",t),b.classList.toggle("is-working",r)},D=(e,t="info")=>{L.textContent=e,L.classList.toggle("is-error","error"===t)},F=()=>{if(!y)return;const e="text"===p.type;y.textContent="ğŸ‘",y.classList.toggle("is-visible",e),y.setAttribute("aria-pressed",e?"true":"false"),y.setAttribute("aria-label",e?"éšè— API å¯†é’¥":"æ˜¾ç¤º API å¯†é’¥"),y.setAttribute("title",e?"éšè— API å¯†é’¥":"æ˜¾ç¤º API å¯†é’¥")},N=()=>{const t=h(l,a),r=h(d,g);if(t===e){if("custom"!==m.value&&(m.value=s(r),O(m,f)),"custom"!==_.value){const e=c(r);_.value=E[e]||E.gpt,O(_,v)}M(!0)}};[l,d,m,_].forEach(e=>{const t=document.querySelector(`#${e.id}_custom`);e.addEventListener("change",()=>{O(e,t),e===l||e===d?N():e===_&&M(!0)}),O(e,t)}),y?.addEventListener("click",()=>{p.type="password"===p.type?"text":"password",F(),p.focus({preventScroll:!0})}),F(),C?.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(L.textContent||""),C.textContent="å·²å¤åˆ¶",window.setTimeout(()=>{C.textContent="å¤åˆ¶ç»“æœ"},1200)}catch{C.textContent="å¤åˆ¶å¤±è´¥",window.setTimeout(()=>{C.textContent="å¤åˆ¶ç»“æœ"},1200)}}),A?.addEventListener("click",()=>{const e=P(S.value),t=P(x.value),r={config:String(k.value||"").trim(),baseurl:h(m,f),apikey:String(p.value||"").trim(),apimode:h(d,g),provider:h(l,a),model_id:h(_,v),context_window:e,max_tokens:t,reasoning:!!q.checked,inherit_existing:"true"===String(w.value||"").trim()};if(!r.config)return D("é”™è¯¯: è¯·è¾“å…¥åŸå§‹ Config JSON","error"),void T("å¤±è´¥");if(!r.baseurl)return D("é”™è¯¯: è¯·é€‰æ‹©æˆ–è¾“å…¥ Base URL","error"),void T("å¤±è´¥");if(!r.apikey)return D("é”™è¯¯: è¯·è¾“å…¥ API Key","error"),void T("å¤±è´¥");if(!r.provider||!r.apimode||!r.model_id)return D("é”™è¯¯: provider / apimode / model_id ä¸èƒ½ä¸ºç©º","error"),void T("å¤±è´¥");if(null===r.context_window)return D("é”™è¯¯: è¯·å¡«å†™æœ‰æ•ˆçš„æ¨¡å‹æœ€å¤§ä¸Šä¸‹æ–‡ï¼ˆæ­£æ•´æ•°ï¼‰","error"),void T("å¤±è´¥");if(null===r.max_tokens)return D("é”™è¯¯: è¯·å¡«å†™æœ‰æ•ˆçš„æœ€å¤§è¾“å‡ºå†…å®¹ï¼ˆæ­£æ•´æ•°ï¼‰","error"),void T("å¤±è´¥");T("å¤„ç†ä¸­");try{const e=u(r);D(JSON.stringify(e,null,2),"ok"),T("å®Œæˆ"),n("é…ç½®ç”Ÿæˆå®Œæˆï¼ˆä»…å‰ç«¯æœ¬åœ°è½¬æ¢ï¼‰","ok")}catch(e){D(`é”™è¯¯: ${e.message||String(e)}`,"error"),T("å¤±è´¥"),n(`é…ç½®ç”Ÿæˆå¤±è´¥ï¼š${e.message||String(e)}`,"error")}}),N(),M(!1)}export{l as setupConfigGenerator};
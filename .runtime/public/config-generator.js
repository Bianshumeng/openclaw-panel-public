const e="aicodecat",o=Object.freeze({gpt:"https://aicode.cat/v1",claude:"https://aicode.cat",gemini:"https://aicode.cat/v1beta"}),t=Object.freeze({"openai-responses":"gpt","openai-completions":"gpt","anthropic-messages":"claude","google-generative-ai":"gemini"}),n=Object.freeze({gpt:{contextWindow:4e5,maxTokens:128e3,reasoning:!0},claude:{contextWindow:2e5,maxTokens:64e3,reasoning:!0},gemini:{contextWindow:1048576,maxTokens:65536,reasoning:!1}});function a(e){return String(e??"").trim()}function i(e){return"boolean"==typeof e?e:"true"===a(e).toLowerCase()}function r(e,o){const t=Number(e);return!Number.isFinite(t)||t<=0?o:Math.floor(t)}function s(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}export function apiModeFamily(e){return t[a(e)]||"gpt"}export function resolveAicodecatBaseUrl(e){return o[apiModeFamily(e)]}export function resolveProviderId(o,t){const n=a(o);if(n!==e)return n;const i=apiModeFamily(t);return"claude"===i?"aicodecat-claude":"gemini"===i?"aicodecat-gemini":"aicodecat-gpt"}export function convertConfig(e){let o;try{o=JSON.parse(a(e.config))}catch(e){throw new Error(`配置 JSON 格式错误: ${e.message}`)}const t=resolveProviderId(a(e.provider),e.apimode),d=a(e.model_id),c=apiModeFamily(e.apimode),m=n[c]||n.gpt,l=`${t}/${d}`,p=r(e.context_window,m.contextWindow),g=r(e.max_tokens,m.maxTokens),u=void 0===e.reasoning?m.reasoning:i(e.reasoning),f=i(e.inherit_existing),x=s(o)?o:{},y=s(x.agents)?x.agents:{},w=s(y.defaults)?y.defaults:{},v=s(w.model)?w.model:{},b=s(w.models)?w.models:{},h=s(x.gateway)?x.gateway:{},k=f?{...b}:{};s(k[l])||(k[l]={});const O=f?{...y,defaults:{...w,model:{...v,primary:l},models:k}}:{defaults:{model:{primary:l},models:k}},T={...f?x:{},gateway:{...f?h:{},mode:a(h.mode)||"local"},models:{mode:"merge",providers:{[t]:{baseUrl:a(e.baseurl),apiKey:a(e.apikey),api:a(e.apimode),models:[{id:d,name:d,reasoning:u,contextWindow:p,maxTokens:g}]}}},agents:O};return delete T.auth,T}export{e as AICODECAT_PROVIDER};
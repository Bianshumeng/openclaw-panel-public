# 2026-02-20_101_扫描基线

## 基本信息
- 目标小鸡：`vmid=101`（`vm-260218-0011`）
- 执行方式：通过母机 `9900K-1` 使用 QGA 只读扫描
- 执行时间：2026-02-20

## 本轮目标
1. 确认 101 当前运行态与 Docker 依赖情况
2. 确认“必须完整保留”的数据落点（Docker 内/外）
3. 给出迁移前必备备份范围

## 口径对齐（避免误读）
1. 本文是“现状扫描文档”，记录的是当前 101 的 Docker 落点事实。
2. 当前已确认的迁移策略是：`/data/*` 仅作为迁移来源与备份来源，不作为长期运行目录。
3. 迁移完成后的直装运行目录应为官方默认结构（按运行用户解析，例如 `<RUN_HOME>/.openclaw`）。

## 关键发现

### 1) 运行态与网络
- 101 当前运行中，QGA 可用。
- 系统：Debian 13。
- 监听概况：
  - `22`（SSH）对外监听
  - `18080`（nginx）
  - `18789`（nginx）
  - Docker proxy 将管理 Web 端口绑定到 `127.0.0.1:28080`、`127.0.0.1:28789`

### 2) Docker 现状
- 容器：
  - `openclaw-panel`（panel）
  - `openclaw-gateway`（gateway）
- 关键挂载（bind）：
  - `/data/openclaw` -> 容器内 OpenClaw 配置/数据目录
  - `/data/panel` -> 容器内 panel 配置目录
  - `/var/run/docker.sock` -> panel 容器（运维控制）
- Compose 目录：
  - `/opt/openclaw/docker-compose.yml`
  - `/opt/openclaw/.env`

### 3) 数据边界（回答“用户新增内容是否只在 Docker 里”）
- 结论：不是只在 Docker 里。
- 该机采用 bind 挂载，核心业务数据主要在宿主机目录（尤其是 `/data/openclaw`、`/data/panel`）。
- 容器可写层差异主要是 `/tmp` 下临时缓存/日志（可重建，不是主配置数据）。
- 注意：这里描述的是“当前来源路径”，不是迁移后的长期运行路径。

### 4) 当前 SSH 安全状态
- `sshd_config` 仍为密码可用（`PasswordAuthentication yes`）。
- 说明：这台 101 还没完成“仅密钥登录、禁密码”的目标状态。

## 必须完整备份的路径（101）

按优先级：
1. `/data/openclaw`（核心：配置、会话、设备、日志、identity、workspace）
2. `/data/panel`（panel 配置）
3. `/opt/openclaw`（compose 与环境变量）

建议同时保留：
4. `/root/OPENCLAW_WEB_LOGIN.txt`（若后续仍需兼容排障）
5. `/root/.ssh/authorized_keys`（登录入口）

可选（体积较大，价值较低）：
6. `/root/.npm`（npm 缓存，不属于业务数据，可不作为迁移必备）

## 迁移前最小备份建议（命令草案）

```bash
TS=$(date +%F_%H%M%S)
BK=/root/migrate-backup-101-$TS
mkdir -p "$BK"

tar -C / -czf "$BK/data-openclaw.tgz" data/openclaw
tar -C / -czf "$BK/data-panel.tgz" data/panel
tar -C / -czf "$BK/opt-openclaw.tgz" opt/openclaw
tar -C / -czf "$BK/root-ssh.tgz" root/.ssh root/OPENCLAW_WEB_LOGIN.txt

sha256sum "$BK"/*.tgz > "$BK/SHA256SUMS.txt"
```

## 风险提示
1. 未完成以上备份前，不应删除 Docker 容器与镜像。
2. 迁移过程中必须保留一键回滚路径（可恢复 compose + 数据包）。
3. 本文记录了结构与路径，不记录敏感值（token/密码已脱敏处理）。

# 2026-02-20_101_直装联调第一轮记录

## 基本信息
- 目标机器：`vmid=101`（`vm-260218-0011`）
- 执行方式：母机 `9900K-1` 通过 QGA 远程执行
- 执行日期：2026-02-20
- 目标：在“不删除 Docker 版”的前提下，先跑通直装版 OpenClaw 与自带 UI 端口链路

## 本轮执行动作（已完成）
1. 停止 Docker 版容器（仅停，不删）
   - `openclaw-gateway`、`openclaw-panel` 已停止运行。
2. 安装直装版 OpenClaw（`--no-onboard`）
   - `openclaw --version` 可用（`2026.2.19-2`）。
3. 路径落点确认
   - 直装运行默认目录：`/root/.openclaw`
   - 旧数据来源目录：`/data/openclaw`
4. 数据迁移（第一轮）
   - 已执行：`cp -a /data/openclaw/. /root/.openclaw/`
   - 已执行：`chown -R root:root /root/.openclaw`
   - 差异结果：仅额外保留 `auth.json`（来源于新装初始化），其余核心数据已对齐。
5. 端口链路联调（自带 UI）
   - 现网 Nginx 规则：`18789 -> 28789`
   - 已将直装 gateway 对齐为监听 `127.0.0.1:28789`
   - 访问验证：
     - `http://127.0.0.1:18789` 未鉴权：`401`
     - `http://127.0.0.1:18789` 带 Basic Auth：`200`
     - 页面标题命中：`OpenClaw Control`

## 关键发现（影响后续改造）
1. `18080` 当前返回 `502`，因为 Docker panel 已停且直装侧未接管该后端。
2. 迁移后关键用户资产已在直装目录可见：
   - `agents/main/sessions/*`
   - `workspace/*`
   - `identity/device.json`
3. `openclaw health` 当前仍提示 `pairing required`，属于网关连通后的鉴权/配对状态问题，不是端口未通。

## 本轮未执行（明确边界）
1. 未删除 Docker 容器/镜像/编排文件（按“先验证后删除”策略保留回退能力）。
2. 未改 SSH 策略（仍遵循“当前阶段不改 SSH”）。
3. 未批量迁移其他小鸡（仅 101 验证）。

## 当前结论
1. “直装默认目录 + 旧数据迁移 + 自带 UI 端口链路”已在 101 跑通第一轮。
2. 下一步应优先处理可视化面板（`18080`）的直装接管与路径适配，再决定删除 Docker 版。

## 下一步（建议顺序）
1. 先完成“龙虾可视化配置页面”对直装路径的适配开发与联调。
2. 在 101 上恢复/接管 `18080` 直装链路并验证配置读写。
3. 你完成页面实测后，再执行“删除 Docker 版 OpenClaw”动作。

## 经验总结（本轮沉淀）
1. “先停不删”是正确策略：可以立即切到直装联调，同时保留快速回退路径。
2. 默认精准备份足够支持迁移：不需要每次都做 `/var/lib/docker` 全量重备。
3. 路径迁移必须以官方默认目录为目标：`/data/*` 只作为来源，不作为长期运行目录。
4. 真实交付必须看用户体验验收，不是只看进程启动：
   - 页面可打开
   - 历史会话可见
   - 记忆/文件/脚本可读写
5. 批量迁移前必须先打通面板链路（`18080`），否则会造成“服务迁好了但页面不可用”的体验断层。

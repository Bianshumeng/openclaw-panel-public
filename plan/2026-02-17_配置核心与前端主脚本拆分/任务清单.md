# 任务清单

## 1. 文档与基线阶段
- [x] 1.1 完成提案、技术设计、任务清单落盘 | 验收：`plan/2026-02-17_配置核心与前端主脚本拆分/` 文档齐全
- [x] 1.2 建立拆分前基线（测试结果 + 关键手工回放清单） | 验收：形成基线记录并可复用
- [x] 1.3 明确 Linux 一致性回放口径 | 验收：与 Windows 回放步骤一一对应

## 2. 后端配置核心拆分阶段（`src/openclaw-config.js`）
- [x] 2.1 拆出 `schema.js` 与 `helpers.js` | 验收：schema 导出与纯函数单测通过
- [x] 2.2 拆出 `extract.js` | 验收：`extractSettings` 行为与拆分前一致
- [x] 2.3 拆出 `apply.js` | 验收：`applySettings` 行为与拆分前一致
- [x] 2.4 拆出 `storage.js` + 保留门面 `src/openclaw-config.js` | 验收：现有 import 路径无需修改即可运行
- [x] 2.5 补齐/更新单测 | 验收：`npm run test:unit` 通过

## 3. 前端主脚本拆分阶段（`public/app.js`）
- [x] 3.1 提取 `core`（message/theme/runtime/bootstrap） | 验收：全页面可加载，无全局报错
- [x] 3.2 拆分 Dashboard + Model 页面模块（试点） | 验收：两页关键交互功能等价
- [x] 3.3 拆分 Channels 与 Telegram/Feishu/Discord/Slack 页面模块 | 验收：渠道保存、测试、引导流程正常
- [x] 3.4 拆分 Skills + Chat 页面模块 | 验收：技能启停/写回、聊天流式与会话操作正常
- [x] 3.5 拆分 Service + Update + Logs + Config Generator 页面模块 | 验收：服务控制、更新、日志、配置生成器均正常
- [x] 3.6 收敛 `public/app.js` 为轻入口 | 验收：入口文件仅负责注册与初始化调度

## 4. 验证与发布门禁阶段
- [x] 4.1 全量自动化测试 | 验收：`npm test` 通过
- [x] 4.2 Docker 重建与 9 页手工回放 | 验收：`docker compose up -d --build panel` 后关键流程通过
- [x] 4.3 Linux 回归复验 | 验收：Linux Docker 流程回放通过并记录差异

## 5. 收尾阶段
- [x] 5.1 同步更新主线任务文档状态 | 验收：`plan/2026-02-16_ClawX源码调研/任务清单.md` 补充引用
- [x] 5.2 如无外部行为变更，在任务汇报明确“纯结构改造” | 验收：规格变更是否需要落盘有书面结论
- [ ] 5.3 归档（待用户验收后） | 验收：目录与证据完整

## 经验记录
### 步骤 1.1 完成记录
- 实际情况：已完成本任务三份规划文档落盘，明确“先后端再前端、先试点再全量”的执行路径。
- 遇到问题：仓库已有大量业务功能，拆分若不分阶段容易出现定位困难；已在任务清单中强制阶段提交与阶段验证。
- 技术债：尚未建立拆分前的测试基线记录（1.2），这是下一步必须先补的门禁。

### 步骤 1.2 / 1.3 完成记录
- 实际情况：已完成拆分前基线验证：`npm test` 全通过（1 条既有 skip）、`docker compose up -d --build panel` 成功、11 个核心 API/页面探针全部 200。
- 遇到问题：无阻断问题；构建日志出现孤儿容器提示，不影响本任务拆分改造。
- 技术债：Linux 实地回放尚未执行，仅完成一致性回放口径定义；需在 4.3 阶段补实测证据。

### 步骤 2.1 ~ 2.5 完成记录
- 实际情况：`src/openclaw-config.js` 已拆分为 `schema/helpers/extract/apply/storage` 五个子模块，原文件保留兼容门面导出。
- 遇到问题：无行为层阻断问题；拆分后所有既有导入路径保持不变，避免影响服务层引用。
- 技术债：`openclaw-config` 拆分已完成，下一步主要风险转移到 `public/app.js` 的页面级拆分。

### 步骤 3.1 ~ 3.6 完成记录
- 实际情况：`public/app.js` 已收敛为入口调度，核心逻辑拆分为 `core + pages` 模块，覆盖 Dashboard/Model/Channels/Skills/Chat/Service/Update/Logs/Config Generator 全部页面路径。
- 遇到问题：拆分初版在 Dashboard 页面出现 `toNonNegativeInt` 未导入导致浏览器运行时报错；已补导入并完成浏览器控制台复验。
- 技术债：当前模块拆分已形成清晰边界；后续若继续增长，建议把 `system-page.js` 再按“渠道/服务/更新/日志”细拆。

### 步骤 4.1 ~ 4.3 完成记录
- 实际情况：已完成 `npm test`、Docker 重建、关键路由可达性探针、浏览器控制台检查和 Linux 容器内 API 回放。
- 遇到问题：Linux 容器回放初次使用了错误端口（8080）；校正为容器内实际监听端口 `18080` 后验证通过。
- 技术债：4.3 目前基于 Linux 容器回放完成；后续如需严格生产宿主验证，可在真实 Linux 主机补做一次同口径手工页面回放。

### 步骤 5.1 / 5.2 完成记录
- 实际情况：已将拆分进展同步回主线任务文档 `plan/2026-02-16_ClawX源码调研/任务清单.md`，形成跨任务可追溯记录。
- 结论：本轮属于“纯结构治理 + 缺陷修复（导入缺失）”，未引入新的外部 API 契约变化；无需新增规格变更文档，已在任务汇报中保留书面结论。

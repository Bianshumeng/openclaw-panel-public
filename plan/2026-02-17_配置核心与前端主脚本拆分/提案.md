# 配置核心与前端主脚本拆分

创建时间：2026-02-17 05:20:00

## 为什么做
- `src/openclaw-config.js` 当前约 856 行，同时承担 schema、配置提取、配置写回、文件读写四类职责，回归风险高。
- `public/app.js` 当前约 3770 行，承担 9 个页面的逻辑与全局状态，改动任何页面都可能误伤其它页面。
- 现有产品面向小白用户，功能要稳；继续单文件膨胀会直接拉高线上故障概率和迭代成本。

## 改什么
- 对 `src/openclaw-config.js` 做“有边界拆分”，保持对外 API 不变。
- 对 `public/app.js` 做“按核心能力 + 按页面职责拆分”，保留现有路由与用户可见行为。
- 补齐拆分后的回归测试与 Docker 运行态验证，确保 Linux 生产可用。

## 影响范围
- 后端：`src/openclaw-config.js`、新增 `src/openclaw-config/*` 子模块、`src/server.js` 及引用方（仅导入路径/导出兼容层）。
- 前端：`public/app.js`、新增 `public/js/core/*`、`public/js/pages/*`。
- 测试：`test/unit/openclaw-config.test.js`、必要时新增前端关键路径 smoke 校验脚本。
- 风险等级：L2（跨模块结构改造，涉及配置写入与多页面交互主干）。

## 不做什么（边界）
- 不改变任何现有 API 契约（字段名、路由、响应结构保持一致）。
- 不引入 React/Vue/Vite 等新构建体系。
- 不改 OpenClaw/龙虾 Bot 核心源码。
- 不在本任务内做额外产品功能扩展，只做结构治理与等价迁移。

## 验证（存在风险时必填）
- 自动化：`npm run test:unit`、`npm run test:regression`、`npm test` 全通过。
- 语法检查：拆分后所有新文件执行 `node --check`。
- 运行态：`docker compose up -d --build panel` 后，9 个页面关键操作通过。
- Linux 一致性门禁：至少补 1 轮 Linux Docker 回放记录（配置保存、模型切换、渠道保存、服务控制、更新检查）。

## 回滚（存在风险时必填）
- 回滚触发条件：
  1. 配置写回出现字段丢失/误写；
  2. 页面交互行为与拆分前不一致；
  3. Docker 运行态出现稳定性回归。
- 回滚步骤：
  1. 以阶段提交为单位回退到上一个稳定 commit；
  2. 保留本次失败证据（日志/步骤/输入）并回写任务清单；
  3. 调整拆分边界后从最近通过阶段重进。

# OpenClaw面板 - 变更

## 新增需求

### 需求：插件式控制边界强约束
控制台必须作为龙虾 Bot 的外部控制器运行，不得通过修改龙虾 Bot 源码实现面板能力。

#### 场景：能力扩展
- 当 新增 Dashboard/Skills/Chat 等能力
- 那么 系统必须通过配置文件、服务控制与 Gateway 接口实现，而不是改写 OpenClaw 内核

#### 场景：升级兼容
- 当 OpenClaw 升级
- 那么 控制台必须通过适配层处理兼容差异，保持最小耦合

---

### 需求：状态总览增强
仪表盘必须展示面板关键运行指标，并支持模型快速切换与风险提示。

#### 场景：状态卡片
- 当 用户打开仪表盘
- 那么 系统必须展示 Gateway 状态、当前模型与提供商、渠道状态分布、Skills 启用数、错误摘要、版本信息

#### 场景：模型切换风险提示
- 当 用户从大上下文模型切到小上下文模型
- 那么 系统必须提示“可能因上下文超限导致失败”的风险

---

### 需求：Chat 能力迁移（控制台版）
控制台必须支持多会话、流式消息与思考状态显示，但不替代龙虾 Bot 原生对话页。

#### 场景：多会话
- 当 用户切换或新建会话
- 那么 系统必须按 `sessionKey` 隔离历史，不得串话

#### 场景：流式消息
- 当 用户发送消息
- 那么 系统必须实时展示 `delta`，并在 `final` 时完成消息落地

#### 场景：思考状态
- 当 用户开启/关闭思考显示
- 那么 系统必须仅影响前端展示，不改变后端推理请求参数

#### 场景：中止执行
- 当 用户点击中止
- 那么 系统必须调用中止接口并恢复输入态

---

### 需求：Skills 管理
控制台必须提供技能状态可视化与启停管理能力。

#### 场景：技能列表
- 当 用户进入 Skills 页面
- 那么 系统必须展示技能名称、启用状态、更新时间与简要说明

#### 场景：高风险操作确认
- 当 用户执行可能影响运行稳定性的技能操作
- 那么 系统必须进行二次确认并记录审计信息

---

### 需求：渠道管理归属清晰
渠道管理页面必须明确为 OpenClaw 真实渠道配置入口，不引入面板私有渠道模型。

#### 场景：渠道配置
- 当 用户配置 Telegram/飞书等渠道
- 那么 系统必须写回 OpenClaw 对应渠道字段并支持连通性测试

#### 场景：能力降级
- 当 某渠道接口不可用
- 那么 系统必须优雅降级并提示原因，不得阻塞其他渠道配置

---

### 需求：提供商与更新流程优化
控制台必须保留当前提供商与版本更新能力，并可按更优交互增强，但不得破坏现有流程。

#### 场景：提供商配置
- 当 用户使用模板或自定义模式配置提供商
- 那么 系统必须保证模型 ID、API 模式、URL 联动规则正确

#### 场景：版本更新
- 当 用户检查更新、升级或回滚
- 那么 系统必须保持 Docker 运行态兼容与失败回滚能力

## 修改需求
### 需求：可视化配置中心
（保留主规格原文，实施时按本变更新增“Chat 控制台能力”与“Skills 管理能力”入口，不改变原有模型与渠道配置基线。）

## 移除需求
### 需求：首次安装向导迁移
移除原因：目标场景为预装交付服务器，用户拿到即用，不需要首启引导。
迁移方案：保留简洁提示文案与配置校验，不引入向导流程。

## 契约变更（草案）
| 字段/接口 | 类型 | 必需 | 约束 | 兼容性说明 | 备注 |
|------|------|------|------|-----------|------|
| `GET /api/dashboard/summary` | HTTP | 是 | 返回聚合状态 | 新增接口，不影响旧接口 | 仪表盘读取 |
| `GET /api/chat/sessions` | HTTP | 是 | 返回会话列表 | 新增接口 | 对话控制台 |
| `GET /api/chat/history` | HTTP | 是 | 必须带 `sessionKey` | 新增接口 | 对话控制台 |
| `POST /api/chat/send` | HTTP | 是 | 文本非空或附件非空 | 新增接口 | 对话控制台 |
| `POST /api/chat/abort` | HTTP | 是 | 需提供会话标识 | 新增接口 | 中止当前运行 |
| `GET /api/chat/stream` | SSE/WS | 是 | 支持断线重连 | 新增接口 | 流式消息 |
| `GET /api/skills` | HTTP | 是 | 返回技能状态列表 | 新增接口 | Skills 管理 |
| `POST /api/skills/:id/toggle` | HTTP | 是 | 高风险动作需确认 | 新增接口 | Skills 启停 |

### 示例：发送消息请求（草案）
```json
{
  "sessionKey": "agent:main:session-1739690000000",
  "message": "总结一下今天的错误日志",
  "attachments": []
}
```

### 示例：聊天流事件（草案）
```json
{
  "runId": "run_abc123",
  "sessionKey": "agent:main:session-1739690000000",
  "state": "delta",
  "message": {
    "role": "assistant",
    "content": [
      { "type": "text", "text": "正在分析..." }
    ]
  }
}
```

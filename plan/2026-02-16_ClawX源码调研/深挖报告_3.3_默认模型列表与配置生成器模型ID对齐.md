# 深挖报告 3.3：默认模型列表与配置生成器模型 ID 对齐

创建时间：2026-02-16

## 本轮目标

完成任务 `3.3`：对齐“设置当前默认模型”与“配置生成器”使用的默认模型 ID 列表，确保保存时模型引用稳定且可预期。

## 实施范围

- 前端：
  - `public/index.html`
  - `public/app.js`
- 文档与证据：
  - `plan/2026-02-16_ClawX源码调研/任务清单.md`
  - `plan/2026-02-16_ClawX源码调研/规格变更/OpenClaw面板.md`
  - `plan/2026-02-16_ClawX源码调研/evidence/model-id-alignment-3.3-live.md`

## 关键改动

### 1) 去除配置生成器模型下拉的静态硬编码

- `public/index.html` 中 `#cfg_model_id` 改为运行时动态渲染，避免“模板新增模型后 HTML 未同步”导致的漂移。

### 2) 新增统一模型选项渲染函数

- 在 `public/app.js` 新增 `fillDefaultModelOptions()`，统一负责：
  - 渲染 `DEFAULT_MODEL_OPTIONS`；
  - 按需附加 `custom` 选项；
  - 保留/回退当前选择值。

### 3) 配置生成器与模板高级参数复用同一模型列表来源

- `setupConfigGenerator()` 使用 `fillDefaultModelOptions(..., { includeCustom: true })`；
- `renderTemplatePreset()` 使用同一函数填充 `template_default_model_id`；
- 从而保证两个入口的预置模型 ID 顺序和内容完全一致。

## 验证结果

1. 自动化：
- `node --check public/app.js` 通过
- `npm run test:unit` 通过（48/48）
- `npm run test:regression` 通过（3 pass / 1 skip）

2. Docker：
- `docker compose up -d --build panel` 成功

3. 运行态一致性：
- DevTools 实测 `cfg_model_id`（去掉 `custom`）与 `template_default_model_id` 列表完全一致；
- `model_default_ref` 下拉包含所有预置模型 ID；
- 证据：`evidence/model-id-alignment-3.3-live.md`。

## 与用户视角一致性

改造前：
- 模型 ID 列表在不同区域由不同实现维护，后续很容易出现“这边有、那边没有”。

改造后：
- 模型 ID 列表单点维护，所有页面同源渲染；
- 小白用户在不同页面看到的模型集合保持一致，减少困惑。

## 结论

`3.3` 已完成并通过验证。下一步进入 `3.4`：完善 API 模式下拉与 GPT/Claude/Gemini 联动（URL 与模式可自动切换且可覆写）。

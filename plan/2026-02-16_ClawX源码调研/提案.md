# ClawX 能力迁移（插件式控制台）

创建时间：2026-02-16 21:10:00

## 为什么做
- 当前控制台已经覆盖模型、渠道、更新、日志，但在“状态总览、技能管理、聊天交互能力”上仍有体验和能力缺口。
- `third_party/ClawX` 已验证一套成熟的 OpenClaw 可视化交互逻辑，可作为能力来源；但其实现依赖 Electron，不适合直接照搬到当前 Web + Docker 架构。
- 本次目标不是“克隆一个 ClawX 桌面端”，而是将高价值能力按插件式控制器架构迁移到现有面板，确保长期可维护。

## 改什么
- 建立完整迁移文档体系（提案、任务清单、技术设计、规格变更、六份规格最小集）。
- 明确迁移边界并分批实施：
  - 迁移：状态总览补齐、Skills 管理、Chat 的多会话/流式/思考状态能力（按主聊天页体验落地）、提供商与更新能力增强。
  - 保留并增强：模型与提供商配置页、仪表盘、渠道配置页。
  - 不迁移：首次安装向导、任务调度（Cron）、主题系统。
- 先完成“深挖门禁项”再编码，避免盲目复制导致接口与结构失配。

## 影响范围
- 涉及模块（规划中）：`src/server.js`、`src/openclaw-config.js`、`src/logs.js`、新增 `src/gateway-*` 适配层、`public/app.js`、`public/index.html`、`public/styles.css`。
- 涉及页面：`/dashboard`、`/model`、`/channels`、`/chat-console`（由调试控制台升级为“智能对话”主聊天页体验）。
- 涉及配置：`openclaw.json`、`panel.config.json`，以及可能新增的聊天会话缓存字段（仅面板侧）。
- 部署约束：生产为“母机单公网 IP + 分配端口”模式，所有对外端口与外部地址必须配置化，容器内通信走内部网络。
- 风险等级：L2（跨模块、涉及实时流和配置写入链路）。

## 不做什么（边界）
- 不改龙虾 Bot/OpenClaw 源码本体，不将控制台做成 OpenClaw 分叉版本。
- 不迁移 Electron 专属能力：托盘、桌面窗口、系统菜单、auto-updater。
- 不把“聊天能力增强”强耦合到现有配置页；必须通过独立后端适配层和独立前端模块接入。
- 不把聊天页继续做成“只给工程师看的调试窗口”；默认交互必须面向小白用户。
- 不为追求速度跳过结构设计、接口契约、回归验证。

## 待深挖清单（编码前门禁）
- Gateway RPC 支持矩阵：`sessions.list`、`chat.history`、`chat.send`、`chat.abort`、`skills.status`、`skills.update` 在当前 Docker 运行态的可用性与超时行为。
- 流式事件链路：SSE/WS 二选一的稳定性、断线重连策略、前端幂等去重策略。
- Skills 管理边界：哪些能力可由当前面板进程安全执行，哪些必须通过 gateway 代理执行。
- 渠道管理归属确认：渠道页面继续只管理 OpenClaw 实际渠道配置，不引入面板私有“虚拟渠道”概念。
- 安全边界：API Key 与敏感日志展示策略、外网访问约束、Docker socket 暴露风险缓解。

## 验证（存在风险时必填）
- 文档验收：任务顺序、契约、边界、回滚策略必须可追溯并经用户确认。
- 技术验收：完成深挖门禁后，先提交接口可行性报告，再进入编码。
- 实施验收：每阶段必须提供至少一类证据（自动化测试、脚本输出、手工回放）。

## 回滚（存在风险时必填）
- 回滚触发条件：关键接口不可用、配置写入破坏现有功能、流式通道不稳定导致面板不可用。
- 回滚步骤：
  1. 关闭新增功能入口（功能开关或路由回退）。
  2. 还原接口调用路径到现有稳定实现。
  3. 恢复上一版本文档定义并重新评审方案。

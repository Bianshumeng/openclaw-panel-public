# 深挖报告 2.2：仪表盘模型快速切换

创建时间：2026-02-16

## 本轮目标

完成任务 `2.2`：在仪表盘提供模型快速切换能力，并保持上下文降级风险提示准确可用。

## 实施范围

- 前端：
  - `public/index.html`
  - `public/app.js`
- 文档与证据：
  - `plan/2026-02-16_ClawX源码调研/任务清单.md`
  - `plan/2026-02-16_ClawX源码调研/evidence/dashboard-quick-model-switch-live.md`

## 关键改动

### 1) 仪表盘新增快速切换控件

- 新增控件：
  - `dashboard_quick_context_tokens`（当前会话上下文）
  - `dashboard_quick_model_ref`（目标模型下拉）
  - `dashboard_quick_switch`（一键切换）
- 支持直接在仪表盘切换默认模型，减少用户跳页操作。

### 2) 切换逻辑复用与收敛

- 新增模型辅助函数：
  - `collectCatalogModelEntries`
  - `findModelEntryByRef`
  - `confirmModelSwitchRisk`
  - `switchDefaultModelByEntry`
- 模型页卡片切换与仪表盘切换统一复用同一风险判断和保存逻辑，避免双实现分叉。

### 3) 上下文输入状态统一

- 仪表盘与模型页的上下文输入通过 `data-dashboard-context-input` 统一管理；
- 两处输入共享 `DASHBOARD_CONTEXT_KEY`（`localStorage`），并双向同步，保证风险提示一致。

## 验证结果

1. 自动化：
   - `npm run test:unit` 通过
   - `npm run test:regression` 通过
2. Docker：
   - `docker compose up -d --build panel` 成功
3. 运行态：
   - 仪表盘控件可见且可选择目标模型；
   - 上下文降级场景触发确认提示；
   - 取消确认不会误切换当前模型；
   - 证据：`evidence/dashboard-quick-model-switch-live.md`。

## 与用户视角一致性

改造前：
- 只能去“模型与提供商配置”页面切换模型；
- 仪表盘只能看状态，不能直接操作。

改造后：
- 仪表盘可“看 + 切换”一体化；
- 高风险切换（大上下文 -> 小上下文）会给出明确提示。

## 结论

`2.2` 已完成。仪表盘阶段（`2.1/2.2/2.3`）已全部闭环。  
下一主线可转入 `3.x`（模型与提供商页体验增强）或 `5.x`（Skills 配置写回能力）。

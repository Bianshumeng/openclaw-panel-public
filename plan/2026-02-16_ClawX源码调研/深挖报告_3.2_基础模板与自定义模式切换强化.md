# 深挖报告 3.2：基础模板与自定义模式切换强化

创建时间：2026-02-16

## 本轮目标

完成任务 `3.2`：强化模型页“基础模板”与“自定义模式”切换，确保模板模式下用户只需填写最少必要字段即可完成提供商配置。

## 实施范围

- 前端：
  - `public/index.html`
  - `public/styles.css`
  - `public/app.js`
- 文档与证据：
  - `plan/2026-02-16_ClawX源码调研/任务清单.md`
  - `plan/2026-02-16_ClawX源码调研/规格变更/OpenClaw面板.md`
  - `plan/2026-02-16_ClawX源码调研/evidence/model-provider-mode-switch-3.2-live.md`

## 关键改动

### 1) 路径 2 增加“工作模式”总入口

- 新增 `model_provider_mode_section`，支持两种模式显式切换：
  - 基础配置（推荐）
  - 自定义模式
- 新增模式提示文案，明确当前模式目的和适用场景。

### 2) 基础模板模式默认最小输入

- 模板模式主区域仅保留高频字段：
  - 模板类型
  - 提供商名称
  - API 地址
  - API Key
- 低频字段移入折叠区“高级参数（通常不用改）”：
  - API 模式
  - 默认模型
  - 保存后设为当前默认模型

### 3) 自定义模式默认隐藏，按需打开

- `model_provider_custom_section` 默认隐藏，避免小白用户首次进入就看到复杂 JSON 字段。
- 用户主动切换后才展示完整自定义配置。

### 4) JS 模式状态管理

- 新增 `setModelProviderMode()`：
  - 统一控制模式按钮激活态、提示文案、面板显隐；
  - 将模式状态收敛到 `modelEditorState.providerMode`。
- 在模型页初始化与回填时默认回到 `template` 模式，保持“新手优先”体验。

## 验证结果

1. 自动化：
- `node --check public/app.js` 通过
- `npm run test:unit` 通过（48/48）
- `npm run test:regression` 通过（3 pass / 1 skip）

2. Docker：
- `docker compose up -d --build panel` 成功

3. 页面结构：
- `/model` 页面已包含模式切换节点与折叠高级参数
- 证据：`evidence/model-provider-mode-switch-3.2-live.md`

## 与用户视角一致性

改造前：
- 新增提供商页面一次性展示大量字段，小白难以判断“哪些必填、哪些可忽略”。

改造后：
- 默认只给“能跑通所需”的最小输入；
- 高级项可按需展开；
- 自定义 JSON 不再默认打断主流程。

## 结论

`3.2` 已完成并通过验证。下一步进入 `3.3`：继续对齐“默认模型下拉列表”和“配置生成器模型 ID”的一致性细节。

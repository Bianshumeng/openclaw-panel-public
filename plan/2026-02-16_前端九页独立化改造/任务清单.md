# 任务清单

## 1. 文档与门禁阶段
- [x] 1.1 完成提案、技术设计、任务清单、规格变更落盘 | 验收：`plan/2026-02-16_前端九页独立化改造/` 文档齐全
- [x] 1.2 明确两页试点验收口径 | 验收：Dashboard/Model 关键路径清单明确

## 2. 基础拆分能力阶段
- [x] 2.1 建立共享壳层与导航复用机制 | 验收：侧栏与页头不重复硬编码 9 份
- [x] 2.2 建立页面级初始化入口（按页加载脚本） | 验收：无关页面脚本不再在当前页执行
- [x] 2.3 服务端已知路由映射到独立 HTML | 验收：`/dashboard`、`/model` 可直达对应文件

## 3. 两页试点阶段（本轮）
- [x] 3.1 拆分 Dashboard 页面为独立文件 | 验收：总览刷新、模型切换、运行态列表正常
- [x] 3.2 拆分 Model 页面为独立文件 | 验收：默认模型切换、提供商模板/自定义配置正常
- [x] 3.3 两页试点回归 + Docker 重建验证 | 验收：`npm test` + `docker compose up -d --build panel` 通过
- [x] 3.4 根据试点结果更新文档 | 验收：任务清单与经验记录同步

## 4. 其余七页批量拆分阶段（后续）
- [x] 4.1 Skills 页面拆分 | 验收：状态、启停、配置回写正常
- [x] 4.2 Chat 页面拆分 | 验收：多会话、流式、停止、附件正常
- [x] 4.3 配置生成器页面拆分 | 验收：生成逻辑与继承选项正常
- [x] 4.4 Channels 页面拆分 | 验收：配置保存与连通性测试正常
- [x] 4.5 Update 页面拆分 | 验收：检查/升级/回滚链路正常
- [x] 4.6 Service 页面拆分 | 验收：服务控制命令可用
- [x] 4.7 Logs 页面拆分 | 验收：日志读取与筛选正常

## 5. 收尾阶段
- [ ] 5.1 合并规格变更到 `plan/规格/OpenClaw面板.md` | 验收：主规格与实现一致
- [ ] 5.2 更新 README 与开发说明 | 验收：新增页面结构和开发入口清楚
- [ ] 5.3 归档任务目录 | 验收：归档前验收证据完整

## 经验记录
### 步骤 1.1 完成记录
- 实际情况：已完成九页独立化改造任务文档落盘，明确先试点两页再批量推广。
- 遇到问题：当前仓库已有未提交改动（`AGENTS.md`、`public/*`、既有任务清单），需要在后续提交中做分组隔离，避免混淆。
- 技术债：共享壳层与页面初始化契约尚未编码，属于下一步核心风险点。

### 步骤 2.2 / 2.3 / 3.1 / 3.2 / 3.3 / 3.4 完成记录
- 实际情况：已完成 `dashboard/model` 两页独立文件拆分，新增 `public/pages/dashboard.html` 与 `public/pages/model.html`，并在 `src/server.js` 增加已知路由到独立文件的映射（`/`、`/dashboard`、`/model`）。
- 实现细节：`public/app.js` 已改为页面感知初始化（按 `data-panel` 是否存在决定是否绑定对应模块），并补齐空元素安全保护，避免独立页缺少无关 DOM 时抛错。
- 验证证据：`npm test` 全量通过；`docker compose up -d --build panel` 成功；`/dashboard` 与 `/model` 已确认返回独立页面文件。
- 遇到问题：浏览器 MCP 当前被已有 profile 占用，无法执行 console 面板校验；本轮以自动化 + 运行态 HTTP 探针替代。
- 技术债：暂无新增阻断债务。

### 步骤 2.1 / 4.1~4.7 完成记录
- 实际情况：已新增 `public/pages/` 九个独立页面文件，并完成全部业务路由映射：`/dashboard`、`/skills`、`/chat-console`、`/model`、`/config-generator`、`/channels`、`/update`、`/service`、`/logs`。
- 实际情况补充：根路径 `/` 已显式映射到 `pages/model.html`，双入口问题已收敛。
- 实现细节：新增 `data-sidebar-nav` 导航容器与 `renderSidebarTabs()`，将侧栏导航生成逻辑集中到 `public/app.js`，避免 9 页重复硬编码导航项。
- 验证证据：`npm test` 全量通过；Docker 重建通过；9 条路由均命中“单页面单面板”输出（每页仅包含对应 `data-panel`）。
- 遇到问题：浏览器 MCP 在当前环境被占用，无法补采控制台日志；已用自动化 + HTTP 探针替代验证。
- 技术债：收尾阶段建议评估是否完全移除旧 `index.html` 多面板回退逻辑，进一步降低维护分叉风险。

### 步骤 4.x 后续修复记录（侧栏闪烁）
- 实际情况：用户反馈“切页时左侧侧栏闪烁”，根因定位为侧栏导航采用运行时动态注入（页面初始为空，JS 执行后填充）。
- 修复动作：将 9 个独立页面的侧栏改为静态预渲染，并移除 `public/app.js` 中 `renderSidebarTabs()` 与对应动态导航常量。
- 验证证据：`npm test` 通过；`docker compose up -d --build panel` 通过；页面刷新后导航可直接展示，不再依赖 JS 注入。
- 技术债：若后续继续扩展导航项，需通过脚本模板统一生成，避免手工改 9 份造成漂移。

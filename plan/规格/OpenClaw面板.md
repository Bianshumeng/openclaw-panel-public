# OpenClaw面板

最后更新：2026-02-26

## 能力概述

提供 OpenClaw 的本机可视化配置、服务管理与日志排障能力，目标是让最终用户不需要命令行即可完成常见运维操作。

## 需求列表

### 需求：可视化配置中心

面板必须支持以字段化方式编辑 OpenClaw 关键配置，至少覆盖 API、Base URL、模型、Telegram、飞书、Discord、Slack 等常用字段。

#### 场景：字段化编辑
- 当 用户进入配置中心并修改关键字段
- 那么 系统必须进行输入校验并写入配置文件

#### 场景：敏感字段保护
- 当 用户查看已保存的 API Key 或 Secret
- 那么 面板必须默认掩码显示，不直接明文回显

#### 场景：字段校验
- 当 用户提交配置
- 那么 系统必须执行必填、URL 格式、模型名非空等基础校验

#### 场景：OpenClaw 官方字段映射
- 当 用户修改模型与渠道配置
- 那么 系统必须映射到官方字段：`models.providers.*`、`agents.defaults.model.primary`、`channels.telegram.*`、`channels.feishu.*`、`channels.discord.*`、`channels.slack.*`

### 需求：运行参数可配置

面板必须支持监听地址、端口、OpenClaw 配置路径、服务名、容器名、日志来源、运行时模式等运行参数可配置。

#### 场景：模板适配
- 当 面板部署到不同模板机
- 那么 运维人员必须可通过配置修改运行参数而无需改代码

### 需求：服务生命周期控制

面板必须支持对 OpenClaw 运行实例执行启动、停止、重启、状态查询，且兼容 `systemd` 与 `docker` 两种运行时。

#### 场景：可视化启停
- 当 用户点击服务控制按钮
- 那么 系统必须返回明确的成功或失败结果及错误原因

#### 场景：运行时切换
- 当 目标环境采用 Docker 部署
- 那么 系统必须通过容器名执行状态查询与启停控制，而不是依赖 systemd

### 需求：网关配对自愈操作

面板必须支持读取并批准 Gateway 的 pending 设备配对请求，帮助用户在 `pairing required` 场景下无需命令行即可恢复连接。

#### 场景：一键批准待处理配对
- 当 用户在仪表盘点击“批准待处理配对”
- 那么 系统必须读取 pending 请求并依次执行批准，返回批准数量与失败详情

#### 场景：无 pending 的空操作
- 当 当前没有待批准配对请求
- 那么 系统必须返回“无需处理”的成功结果，不报错

### 需求：仪表盘网关快速重启动作

面板必须在仪表盘提供“重启网关服务”入口，调用既有服务控制链路并反馈执行结果。

#### 场景：一键重启网关
- 当 用户在仪表盘点击“重启网关服务”
- 那么 系统必须触发网关重启并反馈成功或失败原因

#### 场景：跨平台重启提示
- 当 面板运行在 Windows 或非 systemd 环境
- 那么 系统必须优先调用 `openclaw gateway restart`，若 CLI 缺失需给出可执行提示

### 需求：Gateway Token 强制轮换

面板必须在仪表盘提供“一键重置 Gateway Token”入口，点击后始终生成新的 Token 并写回 `gateway.auth.token`，避免复用失效令牌。

#### 场景：点击重置后必须生成新 Token
- 当 用户在仪表盘点击“一键重置 Gateway Token”
- 那么 系统必须生成与当前值不同的新 Token，并写入真实配置文件

#### 场景：重置后需提示更新 Control UI
- 当 Gateway Token 重置成功
- 那么 系统必须返回可复制的新 Token，并提示用户在 Control UI 更新后重新连接

#### 场景：重置后自动批准待处理配对
- 当 用户点击“一键重置 Gateway Token”后存在 pending 配对请求
- 那么 系统必须自动执行 pending 批准，并返回批准结果供仪表盘展示

### 需求：日志可观测

面板必须提供实时日志查看与错误定位能力。

#### 场景：实时日志
- 当 用户打开日志页面
- 那么 系统必须展示实时追加日志并支持关键字过滤

#### 场景：错误摘要
- 当 系统读取日志记录
- 那么 系统必须提供最近 N 条错误摘要以便快速排障

#### 场景：日志来源切换
- 当 目标环境日志策略不同
- 那么 系统必须支持 `journal`、`file` 与 `docker` 三种日志来源

### 需求：智能对话主页面

面板必须提供面向小白用户的聊天页面，支持多会话、流式回复、思考状态展示开关与停止回复。

#### 场景：多会话切换
- 当 用户在聊天页切换或新建会话
- 那么 系统必须按 `sessionKey` 隔离历史，避免串会话

#### 场景：流式回复
- 当 用户发送消息
- 那么 系统必须在消息区原位展示增量回复，并在终态收敛发送状态

#### 场景：思考状态开关
- 当 用户切换“显示思考状态”
- 那么 系统必须仅影响前端展示，不改变后端请求参数

#### 场景：高级调试折叠
- 当 用户进入聊天页
- 那么 高级调试信息必须默认折叠，不干扰主流程

#### 场景：附件发送
- 当 用户上传、粘贴或拖拽附件后发送消息
- 那么 系统必须完成“附件落盘 -> 路径映射 -> 聊天发送”闭环，并保证网关可读取附件

#### 场景：消息富渲染
- 当 助手消息包含 Markdown 或工具调用/结果内容
- 那么 系统必须以可读格式渲染（强调、代码、工具标签），避免用户阅读原始结构化文本

#### 场景：局部错误提示
- 当 聊天页中的单步动作失败（发送、刷新、附件处理、中止、重置）
- 那么 系统必须在聊天区域内给出明确错误提示，不只依赖全局操作时间线

### 需求：仪表盘状态总览

面板必须在仪表盘提供一页式巡检，集中展示运行状态、模型、渠道、Skills、错误摘要和版本信息。

#### 场景：一页巡检
- 当 用户打开仪表盘
- 那么 系统必须在同一页面展示运行状态、当前模型、渠道统计、Skills 统计、错误摘要与版本状态

#### 场景：快捷操作入口
- 当 用户需要继续操作（聊天、模型、渠道、技能、更新、服务控制）
- 那么 仪表盘必须提供可直接跳转的快捷入口，减少侧栏来回切换

#### 场景：运行态明细
- 当 用户需要确认当前“到底哪些渠道和技能在运行”
- 那么 仪表盘必须展示渠道运行态和 Skills 运行态明细列表

#### 场景：模型快速切换风险提示
- 当 用户在仪表盘快速切换默认模型，且目标模型上下文上限更小
- 那么 系统必须提示“可能因上下文超限导致失败”的风险，并要求确认后再执行切换

#### 场景：入口收敛与兼容
- 当 用户从旧入口或历史链接访问状态总览
- 那么 系统必须将状态巡检统一到仪表盘，并保证旧路径可兼容访问

### 需求：版本管理闭环

面板必须提供 OpenClaw 版本检查、升级、回滚能力，并在升级失败时自动回滚。

#### 场景：检查更新
- 当 用户点击“检查更新”
- 那么 系统必须返回当前版本与上游最新版本

#### 场景：一键升级
- 当 用户输入目标版本并执行升级
- 那么 系统必须拉取目标镜像并重建网关容器

#### 场景：升级失败自动回滚
- 当 升级后容器未进入 running 状态
- 那么 系统必须自动回滚到升级前镜像并返回回滚结果

### 需求：安全与公网入口基线

面板必须兼容“母机单公网 IP + 分配端口”部署，同时保持默认安全基线不降低。

#### 场景：默认监听
- 当 面板以 systemd 本地模式首次启动
- 那么 监听地址默认应为 `127.0.0.1`，并允许通过配置覆盖

#### 场景：Docker 对外映射
- 当 面板与网关通过 Docker 运行
- 那么 对外端口必须通过 env/配置文件可配置，不得写死固定公网端口

#### 场景：公网地址展示
- 当 用户打开仪表盘
- 那么 系统必须展示“面板公网访问地址”和“Webhook 回调基地址”，且格式为 `公网IP:端口`

#### 场景：容器内部通信
- 当 面板与网关发生内部通信
- 那么 必须优先使用 Docker 内部网络和共享卷，不经公网入口地址

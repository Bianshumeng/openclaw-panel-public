# Telegram 启用失败根因修复

创建时间：2026-02-17 15:58:00

## 为什么做
- 用户在 `/channels/telegram` 页面执行“保存并启用”失败，核心报错为：`docker exec openclaw-gateway openclaw ...` 中 `openclaw` 可执行文件不存在。
- 当前实现把 Docker 模式 CLI 入口写死为 `openclaw`，与实际镜像（仅提供 `node` + `/app/openclaw.mjs`）不兼容，属于运行时入口假设错误。
- Telegram Bot Token 输入框为 `password`，用户输入后默认点点显示，不符合当前接入流程的可操作性预期。

## 改什么
- 后端：为 Docker 模式 OpenClaw CLI 调用增加“入口自动回退”能力，优先 `openclaw`，失败后自动改用 `node /app/openclaw.mjs`。
- 后端：在 Telegram 基础配置流程内复用已探测到的 CLI 入口，避免每一步重复失败重试。
- 前端：Telegram 基础配置的 Bot Token 输入框改为默认明文可见（`type="text"`）。
- 测试：补充单测覆盖 Docker CLI 回退链路，防止后续回归。

## 影响范围
- 涉及模块：`src/channel-onboarding.js`、`test/unit/channel-onboarding.test.js`、`public/pages/channels-telegram.html`（兼容入口 `public/index.html` 同步）。
- 风险等级：L1（局部行为修复，影响 Telegram onboarding 与 CLI 调用封装）。

## 不做什么（边界）
- 不修改 OpenClaw 网关容器镜像内容。
- 不改动 Telegram 配置字段结构与后端接口契约。
- 不改动其他渠道（Feishu/Discord/Slack）的字段掩码策略。

## 验证（存在风险时必填）
- 自动化：`node --test test/unit/channel-onboarding.test.js`
- 手工：在当前 Docker 运行环境复测 Telegram setup 链路，确认不再出现 `exec: "openclaw": executable file not found`。

## 回滚（存在风险时必填）
- 回滚触发条件：
  1. Telegram setup/pairing 命令执行行为异常；
  2. 命令脱敏输出出现明文泄漏；
  3. 输入框改动引发前端保存流程异常。
- 回滚步骤：
  1. 回退 `src/channel-onboarding.js` 与 `public/pages/channels-telegram.html`/`public/index.html` 到改动前版本；
  2. 重新执行单测与手工流程确认恢复。

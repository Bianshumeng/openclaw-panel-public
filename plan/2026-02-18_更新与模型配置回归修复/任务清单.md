# 任务清单

## 1. 准备阶段
- [x] 1.1 阅读评审问题与相关代码定位
- [x] 1.2 确认无不可逆操作与发布阻断风险

## 2. 实现阶段
- [x] 2.1 修复 helper sleep 执行方式 | 验收：轮询间隔逻辑代码可读且不再调用 docker 伪 sleep
- [x] 2.2 修复 existing 模型 ID 切换后字段同步 | 验收：切换 ID 时 name/context/max 同步刷新
- [x] 2.3 修复 template 模型 ID 切换后名称残留 | 验收：切换 ID 后默认名称与 ID 匹配
- [x] 2.4 修复更新请求抛错时进度条不收口 | 验收：异常路径下 progress 进入失败完成态
- [x] 2.5 加固更新链路容错与回滚 | 验收：失效 token 可回退查询；apply helper 带旧镜像回滚计划

## 3. 验证阶段
- [x] 3.1 node --check 通过
- [x] 3.2 npm run test:unit 通过
- [x] 3.3 API 烟雾验证通过（check/upgrade 异常路径）
- [ ] 3.4 手工回放关键路径

## 4. 收尾阶段
- [x] 4.1 汇总修复结果与风险
- [ ] 4.2 按需提交代码

## 经验记录
### 步骤 2 完成记录
- 实际情况：4 个回归点均已修复，并补充了更新链路两项可靠性加固（GHCR 无 token 回退 + apply 失败回滚预案）。
- 遇到问题：浏览器 MCP 当前会话被占用，未完成 UI 手工回放，需本地页面自测补充。
- 技术债：缺少前端交互自动化测试（模型页字段同步与更新异常进度收口）；缺少端到端更新流程自动化测试（check/pull/apply/reconnect）


# OpenClaw 面板更新入口 + 测试与 CI/CD

创建时间：2026-02-16 00:45:00

## 为什么做
当前面板已支持配置、服务控制、日志排障，但缺少“版本管理闭环”，用户仍需命令行执行升级/回滚。  
同时测试与 CI/CD 基础不足，后续迭代存在回归风险。

## 改什么
- 新增面板更新管理能力：检查版本、升级到指定 tag、回滚到指定 tag。
- 后端增加 Docker 更新/回滚 API，沿用“失败自动回滚”安全策略。
- 前端新增“更新管理”区域与操作反馈。
- 补齐单元测试与回归测试脚本。
- 新增 GitHub Actions：CI（检查+测试）与 CD（面板镜像构建发布）。

## 影响范围
- 涉及模块：`src/server.js`、`public/index.html`、`public/app.js`、`public/styles.css`、新增 `src/docker-update.js` 与测试目录、`.github/workflows/*`
- 风险等级：L2

## 不做什么（边界）
- 本次不做多 Bot 编排（仍只支持 OpenClaw）。
- 本次不改 OpenClaw 上游源码。
- 本次不做前端框架迁移（继续原生 JS/CSS）。

## 验证（存在风险时必填）
- 最小验证步骤：
  - 本地 API 验证：`/api/update/check`、`/api/update/upgrade`、`/api/update/rollback`
  - 运行 `npm run test:unit`、`npm run test:regression`、`npm run check`
  - `docker compose ps` 验证网关与面板存活

## 回滚（存在风险时必填）
- 回滚触发条件：升级后容器未运行，或 API 返回失败
- 回滚步骤：
  - 执行回滚 API 或 `bash deploy/docker-rollback.sh <old-tag>`
  - 恢复 `.env` 对应版本并重启容器

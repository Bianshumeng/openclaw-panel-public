# OpenClaw 可视化面板开发对接说明（v1）

更新时间：2026-02-14

## 结论（先说人话）
- 可以现在就开工开发，不必等云初始化全搞完。
- 但必须把“网络与初始化”做成可配置层，不能写死在代码里。
- 云初始化（cloud-init/模板修复）后补，不影响先把核心功能做出来。

## 当前目标
- 在每台小鸡内预装 OpenClaw + 可视化管理面板。
- 用户不碰命令行，页面完成：
  - API Key / Base URL / 模型配置
  - Telegram/飞书等渠道配置
  - 服务启停/重启/状态
  - 实时日志查看与错误提示

## 当前已知环境（开发必须兼容）
- 小鸡系统：Debian 13（Trixie）。
- 小鸡无独立公网 IP，访问方式为“母鸡 IP + 端口映射”。
- 现网链路：日本入口机 -> WG -> 芬兰母鸡 -> DNAT 到小鸡。
- 端口规划：
  - 售卖池：10000-20000
  - 模板机保留：9900
  - 每台小鸡通常分配 50 连续端口，首端口常用于 SSH 映射到 22。

## 为什么现在就能开发
- 面板核心是“本机配置与本机进程管理”，与端口映射逻辑可解耦。
- 只要面板监听地址、端口、反代信息可配置，后续网络调整不会推翻前端/后端主体。

## 现在就该做的功能（MVP）
1. 配置中心
- OpenClaw 配置字段化编辑（不要只做纯文本编辑器）。
- 支持敏感字段掩码显示（API Key）。
- 配置合法性校验（必填、URL格式、模型名非空等）。

2. 服务控制
- systemd 集成：start/stop/restart/status。
- 操作结果可视化返回（成功/失败原因）。

3. 日志面板
- 实时日志（tail + 自动刷新）。
- 关键字过滤、错误高亮。
- 最近 N 条错误摘要。

4. 接入配置
- Telegram、飞书先做第一批。
- 提供“测试连接”按钮。

## 必须预留的可配置项（避免后期返工）
- `panel.listen_host`（默认 `127.0.0.1`）
- `panel.listen_port`（例如 `18080`）
- `reverse_proxy.enabled`（后续接 Nginx/Caddy）
- `openclaw.config_path`
- `openclaw.service_name`
- `log.source`（journal/file）

## 安全底线（先做最小版本）
- 面板默认仅监听 `127.0.0.1`。
- 对外访问必须走反代 + 登录鉴权（至少 Basic Auth）。
- 所有敏感配置写入时加权限控制（文件 600）。

## 云初始化后补项（后续并行推进）
1. 模板机标准化
- 修复 cloud-init 可用性（当前部分实例一次性密码不生效）。
- 克隆后自动唯一化：
  - hostname
  - machine-id
  - SSH host keys

2. 首次启动初始化脚本
- 自动写入面板基础配置。
- 自动检测端口映射信息（如有 bot 回调参数则写入）。

3. bot 对接
- VM 创建成功后可选调用初始化接口：
  - vmid / lan / port_start / count

## 推荐实施顺序（你现在就能让对方做）
1. 先做面板核心（配置+服务+日志）并在单台 Debian13 上跑通。
2. 再加渠道配置（Telegram/飞书）和测试按钮。
3. 最后接模板化与云初始化（批量交付阶段）。

## 对外说法（给开发工程师）
- 先按“单机可用”开发，网络与端口映射按“可配置接口”处理。
- 不阻塞功能开发，云初始化和模板修复并行进行。
- 目标是尽快交 MVP，再接入自动化开机流程。

